{% extends 'home.html' %}
{% block content %}
<div class="container mt-5" style="max-width:700px;">
    <h2>Conversations</h2>
    <div class="list-group mt-4">
        {% for thread in threads %}
        <a href="{{ url_for('conversation', username=thread.user.username) }}" class="list-group-item list-group-item-action d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
                {% if thread.user.avatar_filename %}
                <img src="{{ url_for('avatar_file', filename=thread.user.avatar_filename) }}" class="rounded-circle me-2" style="width:40px; height:40px; object-fit:cover;">
                {% else %}
                <img src="https://ui-avatars.com/api/?name={{ thread.user.username }}&background=random" class="rounded-circle me-2" style="width:40px; height:40px; object-fit:cover;">
                {% endif %}
                <div>
                    <div><b>{{ thread.user.username }}</b></div>
                    <div class="small text-muted">{{ thread.last_msg.content[:40] }}{% if thread.last_msg.content|length > 40 %}...{% endif %}</div>
                </div>
            </div>
            <div class="text-end">
                <div class="small text-muted">{{ thread.last_msg.timestamp.strftime('%Y-%m-%d %H:%M') if thread.last_msg else '' }}</div>
                {% if thread.unread > 0 %}
                <span class="badge bg-danger">{{ thread.unread }}</span>
                {% endif %}
            </div>
        </a>
        {% else %}
        <p>No conversations yet.</p>
        {% endfor %}
    </div>
</div>
{% endblock %} 